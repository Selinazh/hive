SELECT 'Upgrading MetaStore schema from 0.12.3 to 0.13.0' AS Status from dual;

@015-HIVE-5700.oracle.sql;
@016-HIVE-6386.oracle.sql;
@017-HIVE-6458.oracle.sql;
@018-HIVE-6757.oracle.sql;
@hive-txn-schema-0.13.0.oracle.sql;
@019-HIVE-7118.oracle.sql;

ALTER TABLE TAB_COL_STATS DROP CONSTRAINT TAB_COL_STATS_FK;
ALTER TABLE TAB_COL_STATS ADD CONSTRAINT TAB_COL_STATS_FK FOREIGN KEY (TBL_ID) REFERENCES TBLS (TBL_ID) ON DELETE CASCADE INITIALLY DEFERRED ;
ALTER TABLE PART_COL_STATS DROP CONSTRAINT PART_COL_STATS_FK;
ALTER TABLE PART_COL_STATS ADD CONSTRAINT PART_COL_STATS_FK FOREIGN KEY (PART_ID) REFERENCES PARTITIONS (PART_ID) ON DELETE CASCADE INITIALLY DEFERRED;
ALTER TABLE FUNCS DROP CONSTRAINT FUNCS_FK1;
ALTER TABLE FUNCS ADD CONSTRAINT FUNCS_FK1 FOREIGN KEY (DB_ID) REFERENCES DBS (DB_ID) ON DELETE CASCADE INITIALLY DEFERRED;
ALTER TABLE FUNC_RU DROP CONSTRAINT FUNC_RU_FK1;
ALTER TABLE FUNC_RU ADD CONSTRAINT FUNC_RU_FK1 FOREIGN KEY (FUNC_ID) REFERENCES FUNCS (FUNC_ID) ON DELETE CASCADE INITIALLY DEFERRED;

UPDATE VERSION SET SCHEMA_VERSION='0.13.0', VERSION_COMMENT='Hive release version 0.13.0' where VER_ID=1;
SELECT 'Finished upgrading MetaStore schema from 0.12.3 to 0.13.0' AS Status from dual;
